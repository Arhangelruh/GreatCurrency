@using GreatCurrency.Web.Services
@model (PaginatedList<LegalRatesViewModel> rates, RequestViewModel requestModel);

@{
    ViewData["Title"] = "Legal Rates";
}

<div class="wrapper">
    <div class="request_field">
        <form class="get_statistic_form" method="get" asp-controller="LegalRates" asp-action="Rates">            
            <div class="get_statistic_data">
                <input class="get_statistic_field" type="date" name="startDate" />
                <input class="get_statistic_field" type="date" name="endDate" />
            </div>
            <div class="get_statistic_button_field">
                <button class="get_statistic_button" type="submit" title="Запросить">Запросить</button>
            </div>
        </form>
    </div>

    <div class="wrapper_rates">
        @if (Model.rates is null)
        {
            <div class="message_label">
                <h2>Курсы за указанный период не найдены.</h2>
            </div>
        }
        else
        {
            <div class="legal_rates_table">
                <div class="legal_table_heading"></div>
                <table class="rates_table">
                    <tr>
                        <th>Банк</th>
                        <th>Сдать USD</th>
                        <th>Купить USD</th>
                        <th>Сдать EUR</th>
                        <th>Купить EUR</th>
                        <th>Сдать RUB</th>
                        <th>Купить RUB</th>
                        <th>Сдать CNY</th>
                        <th>Купить CNY</th>
                        <th>Время запроса</th>
                    </tr>
                    @foreach (var rate in Model.rates)
                    {
                        <tr>
                            <td>@rate.OrganisationName</td>                           
                            <td>@(rate.USDBuyRate != 0 ? rate.USDBuyRate : "-")</td>
                            <td>@(rate.USDSaleRate != 0 ? rate.USDSaleRate : "-")</td>                           
                            <td>@(rate.EURBuyRate != 0 ? rate.EURBuyRate : "-")</td>
                            <td>@(rate.EURSaleRate != 0 ? rate.EURSaleRate : "-")</td>
                            <td>@(rate.RUBBuyRate != 0 ? rate.RUBBuyRate : "-")</td>
                            <td>@(rate.RUBSaleRate != 0 ? rate.RUBSaleRate : "-")</td>
                            <td>@(rate.CNYBuyRate != 0 ? rate.CNYBuyRate : "-")</td>
                            <td>@(rate.CNYSaleRate != 0 ? rate.CNYSaleRate : "-")</td>
                            <td>@rate.RequestTime</td>
                        </tr>
                    }
                </table>

                <div class="legal_rates_table_footer">

                    @if (Model.rates.HasPreviousPage)
                    {
                        <a class="change_page" onclick="location.href =
                   '@Url.Action(
                   "Rates",
                   "LegalRates",
                    new { page = Model.rates.PageIndex - 1,
                      pageSize = ViewData["PageSize"],
                      startDate = ViewData["StartData"],
                      endDate = ViewData["EndData"],                      
                     })'">
                            <img title="Previous" src="/images/Left.svg" />
                        </a>
                    }

                    <form class="table-settings" asp-controller="LegalRates" asp-action="Rates" method="get">
                        <input type="date" asp-for=requestModel.startDate name=startDate style="display:none" />
                        <input type="date" asp-for=requestModel.endDate name=endDate style="display:none" />                        
                        <select onchange="this.form.submit()" name="pagesize">
                            <option value="" selected></option>
                            <option value="30">30</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </form>

                    @if (Model.rates.HasNextPage)
                    {
                        <a class="change_page" onclick="location.href =
                 '@Url.Action(
                 "Rates",
                 "LegalRates",
                 new { page = Model.rates.PageIndex + 1,
                      pageSize = ViewData["PageSize"],
                      startDate = ViewData["StartData"],
                      endDate = ViewData["EndData"],                      
                     })'">
                            <img title="Next" src="/images/Right.svg" />
                        </a>
                    }
                </div>
            </div>
        }
    </div>
</div>

@section css {
    <link href="~/css/legalrates.css" rel="stylesheet" asp-append-version="true" />
}